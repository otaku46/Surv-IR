<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Surv IR Interactive Visualization</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a1a;
            color: #e0e0e0;
            overflow: hidden;
        }

        #container {
            display: flex;
            height: 100vh;
        }

        #sidebar {
            width: 300px;
            background: #252525;
            border-right: 1px solid #444;
            overflow-y: auto;
            padding: 20px;
        }

        #graph {
            flex: 1;
            position: relative;
        }

        h1 {
            font-size: 18px;
            margin-bottom: 20px;
            color: #fff;
        }

        .search-box {
            width: 100%;
            padding: 8px 12px;
            background: #333;
            border: 1px solid #555;
            border-radius: 4px;
            color: #e0e0e0;
            margin-bottom: 15px;
        }

        .search-box:focus {
            outline: none;
            border-color: #4a9eff;
        }

        .filter-group {
            margin-bottom: 20px;
        }

        .filter-group h3 {
            font-size: 12px;
            text-transform: uppercase;
            color: #999;
            margin-bottom: 10px;
        }

        .filter-option {
            display: flex;
            align-items: center;
            padding: 6px 0;
            cursor: pointer;
        }

        .filter-option input {
            margin-right: 8px;
        }

        .filter-option label {
            cursor: pointer;
            font-size: 14px;
        }

        .color-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 6px;
        }

        .controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 100;
        }

        .btn {
            padding: 8px 16px;
            background: #333;
            border: 1px solid #555;
            border-radius: 4px;
            color: #e0e0e0;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }

        .btn:hover {
            background: #444;
        }

        .detail-panel {
            position: absolute;
            top: 80px;
            right: 20px;
            width: 350px;
            max-height: 80vh;
            background: #252525;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 20px;
            overflow-y: auto;
            display: none;
            z-index: 100;
        }

        .detail-panel.active {
            display: block;
        }

        .detail-panel h2 {
            font-size: 18px;
            margin-bottom: 10px;
            color: #4a9eff;
        }

        .detail-panel .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: #999;
            font-size: 24px;
            cursor: pointer;
        }

        .detail-section {
            margin-bottom: 15px;
        }

        .detail-section h4 {
            font-size: 12px;
            text-transform: uppercase;
            color: #999;
            margin-bottom: 6px;
        }

        .detail-section p {
            font-size: 14px;
            line-height: 1.5;
        }

        .detail-list {
            list-style: none;
            font-size: 14px;
        }

        .detail-list li {
            padding: 4px 0;
            color: #4a9eff;
        }

        .field-table {
            width: 100%;
            font-size: 13px;
            border-collapse: collapse;
        }

        .field-table td {
            padding: 4px 8px;
            border-bottom: 1px solid #333;
        }

        .field-table td:first-child {
            color: #999;
            width: 40%;
        }

        svg {
            width: 100%;
            height: 100%;
        }

        .node circle {
            cursor: pointer;
            stroke: #fff;
            stroke-width: 2px;
        }

        .node text {
            font-size: 12px;
            pointer-events: none;
            text-anchor: middle;
            fill: #e0e0e0;
        }

        .link {
            stroke: #666;
            stroke-opacity: 0.6;
            stroke-width: 1.5px;
            fill: none;
        }

        .link.highlighted {
            stroke: #4a9eff;
            stroke-width: 3px;
            stroke-opacity: 1;
        }

        .node.highlighted circle {
            stroke: #4a9eff;
            stroke-width: 4px;
        }

        .node.dimmed {
            opacity: 0.2;
        }

        .link.dimmed {
            opacity: 0.1;
        }

        .link-label {
            font-size: 10px;
            fill: #999;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="sidebar">
            <h1>Surv IR Visualization</h1>

            <input type="text" class="search-box" id="search" placeholder="Search nodes...">

            <div class="filter-group">
                <h3>Node Types</h3>
                <div class="filter-option">
                    <input type="checkbox" id="filter-schema" checked>
                    <label for="filter-schema">
                        <span class="color-indicator" style="background: #2980b9;"></span>
                        Schemas
                    </label>
                </div>
                <div class="filter-option">
                    <input type="checkbox" id="filter-func" checked>
                    <label for="filter-func">
                        <span class="color-indicator" style="background: #27ae60;"></span>
                        Functions
                    </label>
                </div>
                <div class="filter-option">
                    <input type="checkbox" id="filter-mod" checked>
                    <label for="filter-mod">
                        <span class="color-indicator" style="background: #8e44ad;"></span>
                        Modules
                    </label>
                </div>
            </div>

            <div class="filter-group">
                <h3>Schema Types</h3>
                <div class="filter-option">
                    <input type="checkbox" id="filter-node" checked>
                    <label for="filter-node">Node</label>
                </div>
                <div class="filter-option">
                    <input type="checkbox" id="filter-edge" checked>
                    <label for="filter-edge">Edge</label>
                </div>
                <div class="filter-option">
                    <input type="checkbox" id="filter-boundary" checked>
                    <label for="filter-boundary">Boundary</label>
                </div>
                <div class="filter-option">
                    <input type="checkbox" id="filter-space" checked>
                    <label for="filter-space">Space</label>
                </div>
            </div>

            <div class="filter-group">
                <h3>Link Types</h3>
                <div class="filter-option">
                    <input type="checkbox" id="link-func" checked>
                    <label for="link-func">Function I/O</label>
                </div>
                <div class="filter-option">
                    <input type="checkbox" id="link-mod" checked>
                    <label for="link-mod">Module Uses</label>
                </div>
                <div class="filter-option">
                    <input type="checkbox" id="link-require" checked>
                    <label for="link-require">Module Requires</label>
                </div>
                <div class="filter-option">
                    <input type="checkbox" id="link-schema" checked>
                    <label for="link-schema">Schema Relations</label>
                </div>
            </div>
        </div>

        <div id="graph">
            <div class="controls">
                <button class="btn" id="reset-zoom">Reset View</button>
                <button class="btn" id="reset-positions">Reset Layout</button>
            </div>

            <div class="detail-panel" id="detail-panel">
                <button class="close-btn" id="close-detail">&times;</button>
                <div id="detail-content"></div>
            </div>

            <svg id="svg"></svg>
        </div>
    </div>

    <script>
        const data = {
  "nodes": [
    {
      "id": "schema.create_user_req",
      "label": "create_user_req",
      "type": "schema",
      "group": "node",
      "metadata": {
        "kind": "node",
        "role": "query",
        "intent": null,
        "purpose": null,
        "fields": {
          "name": "string",
          "email": "string"
        },
        "input": [],
        "output": []
      }
    },
    {
      "id": "schema.user",
      "label": "user",
      "type": "schema",
      "group": "node",
      "metadata": {
        "kind": "node",
        "role": "data",
        "intent": null,
        "purpose": null,
        "fields": {
          "name": "string",
          "user_id": "string",
          "email": "string"
        },
        "input": [],
        "output": []
      }
    },
    {
      "id": "schema.users_snapshot",
      "label": "users_snapshot",
      "type": "schema",
      "group": "boundary",
      "metadata": {
        "kind": "boundary",
        "role": "context",
        "intent": null,
        "purpose": null,
        "fields": {},
        "input": [],
        "output": []
      }
    },
    {
      "id": "func.create_user",
      "label": "create_user",
      "type": "func",
      "group": "function",
      "metadata": {
        "kind": "func",
        "role": null,
        "intent": "Construct User from CreateUserRequest",
        "purpose": null,
        "fields": {},
        "input": [
          "schema.create_user_req"
        ],
        "output": [
          "schema.user"
        ]
      }
    },
    {
      "id": "func.get_user",
      "label": "get_user",
      "type": "func",
      "group": "function",
      "metadata": {
        "kind": "func",
        "role": null,
        "intent": "Get a single User by ID",
        "purpose": null,
        "fields": {},
        "input": [
          "schema.users_snapshot"
        ],
        "output": [
          "schema.user"
        ]
      }
    },
    {
      "id": "func.save_user",
      "label": "save_user",
      "type": "func",
      "group": "function",
      "metadata": {
        "kind": "func",
        "role": null,
        "intent": "Persist User to DB and update users_snapshot",
        "purpose": null,
        "fields": {},
        "input": [
          "schema.user",
          "schema.users_snapshot"
        ],
        "output": [
          "schema.users_snapshot"
        ]
      }
    },
    {
      "id": "mod.user_http_api",
      "label": "user_http_api",
      "type": "mod",
      "group": "module",
      "metadata": {
        "kind": "mod",
        "role": null,
        "intent": null,
        "purpose": "HTTP API for User CRUD operations",
        "fields": {},
        "input": [],
        "output": []
      }
    },
    {
      "id": "schema.CreateTodoRequest",
      "label": "CreateTodoRequest",
      "type": "schema",
      "group": "node",
      "metadata": {
        "kind": "node",
        "role": "request",
        "intent": null,
        "purpose": null,
        "fields": {
          "description": "string",
          "title": "string"
        },
        "input": [],
        "output": []
      }
    },
    {
      "id": "schema.NotFoundError",
      "label": "NotFoundError",
      "type": "schema",
      "group": "node",
      "metadata": {
        "kind": "node",
        "role": "error",
        "intent": null,
        "purpose": null,
        "fields": {
          "message": "string",
          "id": "uuid"
        },
        "input": [],
        "output": []
      }
    },
    {
      "id": "schema.Todo",
      "label": "Todo",
      "type": "schema",
      "group": "node",
      "metadata": {
        "kind": "node",
        "role": "entity",
        "intent": null,
        "purpose": null,
        "fields": {
          "completed": "bool",
          "id": "uuid",
          "title": "string",
          "created_at": "timestamp",
          "description": "string"
        },
        "input": [],
        "output": []
      }
    },
    {
      "id": "schema.TodoListResponse",
      "label": "TodoListResponse",
      "type": "schema",
      "group": "node",
      "metadata": {
        "kind": "node",
        "role": "response",
        "intent": null,
        "purpose": null,
        "fields": {
          "todos": "[Todo]",
          "count": "int"
        },
        "input": [],
        "output": []
      }
    },
    {
      "id": "schema.TodoResponse",
      "label": "TodoResponse",
      "type": "schema",
      "group": "node",
      "metadata": {
        "kind": "node",
        "role": "response",
        "intent": null,
        "purpose": null,
        "fields": {
          "todo": "Todo",
          "timestamp": "timestamp"
        },
        "input": [],
        "output": []
      }
    },
    {
      "id": "schema.UpdateTodoRequest",
      "label": "UpdateTodoRequest",
      "type": "schema",
      "group": "node",
      "metadata": {
        "kind": "node",
        "role": "request",
        "intent": null,
        "purpose": null,
        "fields": {
          "completed": "bool?",
          "id": "uuid",
          "title": "string?",
          "description": "string?"
        },
        "input": [],
        "output": []
      }
    },
    {
      "id": "schema.ValidationError",
      "label": "ValidationError",
      "type": "schema",
      "group": "node",
      "metadata": {
        "kind": "node",
        "role": "error",
        "intent": null,
        "purpose": null,
        "fields": {
          "message": "string",
          "field": "string"
        },
        "input": [],
        "output": []
      }
    },
    {
      "id": "func.createTodo",
      "label": "createTodo",
      "type": "func",
      "group": "function",
      "metadata": {
        "kind": "func",
        "role": null,
        "intent": "Create new todo item",
        "purpose": null,
        "fields": {},
        "input": [
          "schema.CreateTodoRequest"
        ],
        "output": [
          "schema.Todo"
        ]
      }
    },
    {
      "id": "func.deleteTodo",
      "label": "deleteTodo",
      "type": "func",
      "group": "function",
      "metadata": {
        "kind": "func",
        "role": null,
        "intent": "Delete todo by ID",
        "purpose": null,
        "fields": {},
        "input": [
          "schema.Todo"
        ],
        "output": [
          "schema.Todo",
          "schema.NotFoundError"
        ]
      }
    },
    {
      "id": "func.getTodo",
      "label": "getTodo",
      "type": "func",
      "group": "function",
      "metadata": {
        "kind": "func",
        "role": null,
        "intent": "Get todo by ID",
        "purpose": null,
        "fields": {},
        "input": [
          "schema.Todo"
        ],
        "output": [
          "schema.Todo",
          "schema.NotFoundError"
        ]
      }
    },
    {
      "id": "func.listTodos",
      "label": "listTodos",
      "type": "func",
      "group": "function",
      "metadata": {
        "kind": "func",
        "role": null,
        "intent": "List all todos",
        "purpose": null,
        "fields": {},
        "input": [],
        "output": [
          "schema.TodoListResponse"
        ]
      }
    },
    {
      "id": "func.serializeResponse",
      "label": "serializeResponse",
      "type": "func",
      "group": "function",
      "metadata": {
        "kind": "func",
        "role": null,
        "intent": "Convert todo to JSON response",
        "purpose": null,
        "fields": {},
        "input": [
          "schema.Todo"
        ],
        "output": [
          "schema.TodoResponse"
        ]
      }
    },
    {
      "id": "func.updateTodo",
      "label": "updateTodo",
      "type": "func",
      "group": "function",
      "metadata": {
        "kind": "func",
        "role": null,
        "intent": "Update existing todo",
        "purpose": null,
        "fields": {},
        "input": [
          "schema.UpdateTodoRequest"
        ],
        "output": [
          "schema.Todo",
          "schema.NotFoundError"
        ]
      }
    },
    {
      "id": "func.validateCreateRequest",
      "label": "validateCreateRequest",
      "type": "func",
      "group": "function",
      "metadata": {
        "kind": "func",
        "role": null,
        "intent": "Validate create todo request",
        "purpose": null,
        "fields": {},
        "input": [
          "schema.CreateTodoRequest"
        ],
        "output": [
          "schema.CreateTodoRequest",
          "schema.ValidationError"
        ]
      }
    },
    {
      "id": "mod.todo_api",
      "label": "todo_api",
      "type": "mod",
      "group": "module",
      "metadata": {
        "kind": "mod",
        "role": null,
        "intent": null,
        "purpose": "Simple REST API for managing todos",
        "fields": {},
        "input": [],
        "output": []
      }
    },
    {
      "id": "schema.DailyMetrics",
      "label": "DailyMetrics",
      "type": "schema",
      "group": "node",
      "metadata": {
        "kind": "node",
        "role": "output",
        "intent": null,
        "purpose": null,
        "fields": {
          "unique_users": "int",
          "bounce_rate": "float",
          "unique_sessions": "int",
          "date": "date",
          "avg_session_duration": "float",
          "total_page_views": "int"
        },
        "input": [],
        "output": []
      }
    },
    {
      "id": "schema.EnrichedClickEvent",
      "label": "EnrichedClickEvent",
      "type": "schema",
      "group": "node",
      "metadata": {
        "kind": "node",
        "role": "intermediate",
        "intent": null,
        "purpose": null,
        "fields": {
          "os": "string",
          "device_type": "string",
          "session_id": "uuid",
          "page_category": "string",
          "url": "string",
          "city": "string",
          "timestamp": "timestamp",
          "user_id": "uuid",
          "browser": "string",
          "event_id": "uuid",
          "referrer": "string",
          "country": "string",
          "user_agent": "string"
        },
        "input": [],
        "output": []
      }
    },
    {
      "id": "schema.ParseError",
      "label": "ParseError",
      "type": "schema",
      "group": "node",
      "metadata": {
        "kind": "node",
        "role": "error",
        "intent": null,
        "purpose": null,
        "fields": {
          "raw_data": "string",
          "timestamp": "timestamp",
          "error_message": "string"
        },
        "input": [],
        "output": []
      }
    },
    {
      "id": "schema.ParsedClickEvent",
      "label": "ParsedClickEvent",
      "type": "schema",
      "group": "node",
      "metadata": {
        "kind": "node",
        "role": "intermediate",
        "intent": null,
        "purpose": null,
        "fields": {
          "timestamp": "timestamp",
          "event_id": "uuid",
          "session_id": "uuid",
          "user_agent": "string",
          "url": "string",
          "referrer": "string",
          "user_id": "uuid"
        },
        "input": [],
        "output": []
      }
    },
    {
      "id": "schema.RawClickEvent",
      "label": "RawClickEvent",
      "type": "schema",
      "group": "node",
      "metadata": {
        "kind": "node",
        "role": "input",
        "intent": null,
        "purpose": null,
        "fields": {
          "source_ip": "string",
          "raw_log": "string",
          "received_at": "timestamp"
        },
        "input": [],
        "output": []
      }
    },
    {
      "id": "schema.SessionAggregation",
      "label": "SessionAggregation",
      "type": "schema",
      "group": "node",
      "metadata": {
        "kind": "node",
        "role": "intermediate",
        "intent": null,
        "purpose": null,
        "fields": {
          "session_id": "uuid",
          "duration_seconds": "int",
          "end_time": "timestamp",
          "unique_pages": "int",
          "user_id": "uuid",
          "start_time": "timestamp",
          "page_views": "int"
        },
        "input": [],
        "output": []
      }
    },
    {
      "id": "schema.ValidationError",
      "label": "ValidationError",
      "type": "schema",
      "group": "node",
      "metadata": {
        "kind": "node",
        "role": "error",
        "intent": null,
        "purpose": null,
        "fields": {
          "error_message": "string",
          "event_id": "uuid",
          "field": "string"
        },
        "input": [],
        "output": []
      }
    },
    {
      "id": "func.aggregateSessionMetrics",
      "label": "aggregateSessionMetrics",
      "type": "func",
      "group": "function",
      "metadata": {
        "kind": "func",
        "role": null,
        "intent": "Aggregate events by session",
        "purpose": null,
        "fields": {},
        "input": [
          "schema.EnrichedClickEvent"
        ],
        "output": [
          "schema.SessionAggregation"
        ]
      }
    },
    {
      "id": "func.calculateDailyMetrics",
      "label": "calculateDailyMetrics",
      "type": "func",
      "group": "function",
      "metadata": {
        "kind": "func",
        "role": null,
        "intent": "Calculate daily aggregated metrics",
        "purpose": null,
        "fields": {},
        "input": [
          "schema.SessionAggregation"
        ],
        "output": [
          "schema.DailyMetrics"
        ]
      }
    },
    {
      "id": "func.enrichWithDeviceInfo",
      "label": "enrichWithDeviceInfo",
      "type": "func",
      "group": "function",
      "metadata": {
        "kind": "func",
        "role": null,
        "intent": "Enrich event with device, browser, and OS from user agent",
        "purpose": null,
        "fields": {},
        "input": [
          "schema.EnrichedClickEvent"
        ],
        "output": [
          "schema.EnrichedClickEvent"
        ]
      }
    },
    {
      "id": "func.enrichWithGeoData",
      "label": "enrichWithGeoData",
      "type": "func",
      "group": "function",
      "metadata": {
        "kind": "func",
        "role": null,
        "intent": "Enrich event with geographic data from IP address",
        "purpose": null,
        "fields": {},
        "input": [
          "schema.ParsedClickEvent"
        ],
        "output": [
          "schema.EnrichedClickEvent"
        ]
      }
    },
    {
      "id": "func.ingestClickEvents",
      "label": "ingestClickEvents",
      "type": "func",
      "group": "function",
      "metadata": {
        "kind": "func",
        "role": null,
        "intent": "Read raw click events from S3",
        "purpose": null,
        "fields": {},
        "input": [],
        "output": [
          "schema.RawClickEvent"
        ]
      }
    },
    {
      "id": "func.parseClickEvent",
      "label": "parseClickEvent",
      "type": "func",
      "group": "function",
      "metadata": {
        "kind": "func",
        "role": null,
        "intent": "Parse raw log string into structured event",
        "purpose": null,
        "fields": {},
        "input": [
          "schema.RawClickEvent"
        ],
        "output": [
          "schema.ParsedClickEvent",
          "schema.ParseError"
        ]
      }
    },
    {
      "id": "func.validateEvent",
      "label": "validateEvent",
      "type": "func",
      "group": "function",
      "metadata": {
        "kind": "func",
        "role": null,
        "intent": "Validate parsed event for required fields and data quality",
        "purpose": null,
        "fields": {},
        "input": [
          "schema.ParsedClickEvent"
        ],
        "output": [
          "schema.ParsedClickEvent",
          "schema.ValidationError"
        ]
      }
    },
    {
      "id": "func.writeDailyMetrics",
      "label": "writeDailyMetrics",
      "type": "func",
      "group": "function",
      "metadata": {
        "kind": "func",
        "role": null,
        "intent": "Write daily metrics to data warehouse",
        "purpose": null,
        "fields": {},
        "input": [
          "schema.DailyMetrics"
        ],
        "output": []
      }
    },
    {
      "id": "mod.analytics_pipeline",
      "label": "analytics_pipeline",
      "type": "mod",
      "group": "module",
      "metadata": {
        "kind": "mod",
        "role": null,
        "intent": null,
        "purpose": "ETL pipeline for web analytics data processing",
        "fields": {},
        "input": [],
        "output": []
      }
    },
    {
      "id": "schema.CreateUserData",
      "label": "CreateUserData",
      "type": "schema",
      "group": "node",
      "metadata": {
        "kind": "node",
        "role": "input",
        "intent": null,
        "purpose": null,
        "fields": {
          "password_hash": "string",
          "email": "string",
          "first_name": "string",
          "last_name": "string",
          "username": "string"
        },
        "input": [],
        "output": []
      }
    },
    {
      "id": "schema.DatabaseError",
      "label": "DatabaseError",
      "type": "schema",
      "group": "node",
      "metadata": {
        "kind": "node",
        "role": "error",
        "intent": null,
        "purpose": null,
        "fields": {
          "code": "string",
          "message": "string",
          "query": "string"
        },
        "input": [],
        "output": []
      }
    },
    {
      "id": "schema.DuplicateKeyError",
      "label": "DuplicateKeyError",
      "type": "schema",
      "group": "node",
      "metadata": {
        "kind": "node",
        "role": "error",
        "intent": null,
        "purpose": null,
        "fields": {
          "value": "string",
          "message": "string",
          "table": "string",
          "field": "string"
        },
        "input": [],
        "output": []
      }
    },
    {
      "id": "schema.NotFoundError",
      "label": "NotFoundError",
      "type": "schema",
      "group": "node",
      "metadata": {
        "kind": "node",
        "role": "error",
        "intent": null,
        "purpose": null,
        "fields": {
          "message": "string",
          "id": "uuid",
          "table": "string"
        },
        "input": [],
        "output": []
      }
    },
    {
      "id": "schema.UpdateUserData",
      "label": "UpdateUserData",
      "type": "schema",
      "group": "node",
      "metadata": {
        "kind": "node",
        "role": "input",
        "intent": null,
        "purpose": null,
        "fields": {
          "id": "uuid",
          "is_active": "bool?",
          "last_name": "string?",
          "first_name": "string?",
          "email": "string?",
          "username": "string?"
        },
        "input": [],
        "output": []
      }
    },
    {
      "id": "schema.User",
      "label": "User",
      "type": "schema",
      "group": "node",
      "metadata": {
        "kind": "node",
        "role": "entity",
        "intent": null,
        "purpose": null,
        "fields": {
          "email": "string",
          "username": "string",
          "created_at": "timestamp",
          "first_name": "string",
          "is_active": "bool",
          "last_name": "string",
          "id": "uuid",
          "password_hash": "string",
          "updated_at": "timestamp"
        },
        "input": [],
        "output": []
      }
    },
    {
      "id": "schema.UserByEmailQuery",
      "label": "UserByEmailQuery",
      "type": "schema",
      "group": "node",
      "metadata": {
        "kind": "node",
        "role": "query",
        "intent": null,
        "purpose": null,
        "fields": {
          "email": "string"
        },
        "input": [],
        "output": []
      }
    },
    {
      "id": "schema.UserByIdQuery",
      "label": "UserByIdQuery",
      "type": "schema",
      "group": "node",
      "metadata": {
        "kind": "node",
        "role": "query",
        "intent": null,
        "purpose": null,
        "fields": {
          "id": "uuid"
        },
        "input": [],
        "output": []
      }
    },
    {
      "id": "func.createUser",
      "label": "createUser",
      "type": "func",
      "group": "function",
      "metadata": {
        "kind": "func",
        "role": null,
        "intent": "Insert new user into database",
        "purpose": null,
        "fields": {},
        "input": [
          "schema.CreateUserData"
        ],
        "output": [
          "schema.User",
          "schema.DuplicateKeyError",
          "schema.DatabaseError"
        ]
      }
    },
    {
      "id": "func.deleteUser",
      "label": "deleteUser",
      "type": "func",
      "group": "function",
      "metadata": {
        "kind": "func",
        "role": null,
        "intent": "Soft delete user by setting is_active = false",
        "purpose": null,
        "fields": {},
        "input": [
          "schema.UserByIdQuery"
        ],
        "output": [
          "schema.User",
          "schema.NotFoundError",
          "schema.DatabaseError"
        ]
      }
    },
    {
      "id": "func.findUserByEmail",
      "label": "findUserByEmail",
      "type": "func",
      "group": "function",
      "metadata": {
        "kind": "func",
        "role": null,
        "intent": "Find user by email address",
        "purpose": null,
        "fields": {},
        "input": [
          "schema.UserByEmailQuery"
        ],
        "output": [
          "schema.User",
          "schema.NotFoundError",
          "schema.DatabaseError"
        ]
      }
    },
    {
      "id": "func.findUserById",
      "label": "findUserById",
      "type": "func",
      "group": "function",
      "metadata": {
        "kind": "func",
        "role": null,
        "intent": "Find user by ID",
        "purpose": null,
        "fields": {},
        "input": [
          "schema.UserByIdQuery"
        ],
        "output": [
          "schema.User",
          "schema.NotFoundError",
          "schema.DatabaseError"
        ]
      }
    },
    {
      "id": "func.updateUser",
      "label": "updateUser",
      "type": "func",
      "group": "function",
      "metadata": {
        "kind": "func",
        "role": null,
        "intent": "Update existing user in database",
        "purpose": null,
        "fields": {},
        "input": [
          "schema.UpdateUserData"
        ],
        "output": [
          "schema.User",
          "schema.NotFoundError",
          "schema.DatabaseError"
        ]
      }
    },
    {
      "id": "mod.user_repository",
      "label": "user_repository",
      "type": "mod",
      "group": "module",
      "metadata": {
        "kind": "mod",
        "role": null,
        "intent": null,
        "purpose": "User data access layer with transaction support",
        "fields": {},
        "input": [],
        "output": []
      }
    },
    {
      "id": "schema.Book",
      "label": "Book",
      "type": "schema",
      "group": "node",
      "metadata": {
        "kind": "node",
        "role": "entity",
        "intent": null,
        "purpose": null,
        "fields": {
          "title": "string",
          "author": "string",
          "available": "bool",
          "id": "uuid",
          "isbn": "string",
          "published_year": "int"
        },
        "input": [],
        "output": []
      }
    },
    {
      "id": "schema.BookListResponse",
      "label": "BookListResponse",
      "type": "schema",
      "group": "node",
      "metadata": {
        "kind": "node",
        "role": "response",
        "intent": null,
        "purpose": null,
        "fields": {
          "page": "int",
          "books": "[Book]",
          "total": "int"
        },
        "input": [],
        "output": []
      }
    },
    {
      "id": "schema.BookResponse",
      "label": "BookResponse",
      "type": "schema",
      "group": "node",
      "metadata": {
        "kind": "node",
        "role": "response",
        "intent": null,
        "purpose": null,
        "fields": {
          "book": "Book",
          "timestamp": "timestamp"
        },
        "input": [],
        "output": []
      }
    },
    {
      "id": "schema.ConflictError",
      "label": "ConflictError",
      "type": "schema",
      "group": "node",
      "metadata": {
        "kind": "node",
        "role": "error",
        "intent": null,
        "purpose": null,
        "fields": {
          "message": "string",
          "existing_id": "uuid",
          "code": "string"
        },
        "input": [],
        "output": []
      }
    },
    {
      "id": "schema.CreateBookRequest",
      "label": "CreateBookRequest",
      "type": "schema",
      "group": "node",
      "metadata": {
        "kind": "node",
        "role": "request",
        "intent": null,
        "purpose": null,
        "fields": {
          "title": "string",
          "isbn": "string",
          "published_year": "int",
          "author": "string"
        },
        "input": [],
        "output": []
      }
    },
    {
      "id": "schema.DeleteBookRequest",
      "label": "DeleteBookRequest",
      "type": "schema",
      "group": "node",
      "metadata": {
        "kind": "node",
        "role": "request",
        "intent": null,
        "purpose": null,
        "fields": {
          "id": "uuid"
        },
        "input": [],
        "output": []
      }
    },
    {
      "id": "schema.GetBookRequest",
      "label": "GetBookRequest",
      "type": "schema",
      "group": "node",
      "metadata": {
        "kind": "node",
        "role": "request",
        "intent": null,
        "purpose": null,
        "fields": {
          "id": "uuid"
        },
        "input": [],
        "output": []
      }
    },
    {
      "id": "schema.NotFoundError",
      "label": "NotFoundError",
      "type": "schema",
      "group": "node",
      "metadata": {
        "kind": "node",
        "role": "error",
        "intent": null,
        "purpose": null,
        "fields": {
          "resource_id": "uuid",
          "message": "string",
          "code": "string"
        },
        "input": [],
        "output": []
      }
    },
    {
      "id": "schema.UpdateBookRequest",
      "label": "UpdateBookRequest",
      "type": "schema",
      "group": "node",
      "metadata": {
        "kind": "node",
        "role": "request",
        "intent": null,
        "purpose": null,
        "fields": {
          "author": "string?",
          "isbn": "string?",
          "title": "string?",
          "available": "bool?",
          "id": "uuid"
        },
        "input": [],
        "output": []
      }
    },
    {
      "id": "schema.ValidationError",
      "label": "ValidationError",
      "type": "schema",
      "group": "node",
      "metadata": {
        "kind": "node",
        "role": "error",
        "intent": null,
        "purpose": null,
        "fields": {
          "code": "string",
          "field": "string",
          "message": "string"
        },
        "input": [],
        "output": []
      }
    },
    {
      "id": "func.createBook",
      "label": "createBook",
      "type": "func",
      "group": "function",
      "metadata": {
        "kind": "func",
        "role": null,
        "intent": "Create new book in database",
        "purpose": null,
        "fields": {},
        "input": [
          "schema.CreateBookRequest"
        ],
        "output": [
          "schema.Book",
          "schema.ConflictError"
        ]
      }
    },
    {
      "id": "func.deleteBook",
      "label": "deleteBook",
      "type": "func",
      "group": "function",
      "metadata": {
        "kind": "func",
        "role": null,
        "intent": "Delete book from database",
        "purpose": null,
        "fields": {},
        "input": [
          "schema.DeleteBookRequest"
        ],
        "output": [
          "schema.Book",
          "schema.NotFoundError"
        ]
      }
    },
    {
      "id": "func.getBook",
      "label": "getBook",
      "type": "func",
      "group": "function",
      "metadata": {
        "kind": "func",
        "role": null,
        "intent": "Retrieve book by ID from database",
        "purpose": null,
        "fields": {},
        "input": [
          "schema.GetBookRequest"
        ],
        "output": [
          "schema.Book",
          "schema.NotFoundError"
        ]
      }
    },
    {
      "id": "func.listBooks",
      "label": "listBooks",
      "type": "func",
      "group": "function",
      "metadata": {
        "kind": "func",
        "role": null,
        "intent": "List all books with pagination",
        "purpose": null,
        "fields": {},
        "input": [],
        "output": [
          "schema.BookListResponse"
        ]
      }
    },
    {
      "id": "func.serializeBookListResponse",
      "label": "serializeBookListResponse",
      "type": "func",
      "group": "function",
      "metadata": {
        "kind": "func",
        "role": null,
        "intent": "Serialize book list to JSON response",
        "purpose": null,
        "fields": {},
        "input": [
          "schema.BookListResponse"
        ],
        "output": [
          "schema.BookListResponse"
        ]
      }
    },
    {
      "id": "func.serializeBookResponse",
      "label": "serializeBookResponse",
      "type": "func",
      "group": "function",
      "metadata": {
        "kind": "func",
        "role": null,
        "intent": "Serialize book entity to JSON response",
        "purpose": null,
        "fields": {},
        "input": [
          "schema.Book"
        ],
        "output": [
          "schema.BookResponse"
        ]
      }
    },
    {
      "id": "func.updateBook",
      "label": "updateBook",
      "type": "func",
      "group": "function",
      "metadata": {
        "kind": "func",
        "role": null,
        "intent": "Update existing book in database",
        "purpose": null,
        "fields": {},
        "input": [
          "schema.UpdateBookRequest"
        ],
        "output": [
          "schema.Book",
          "schema.NotFoundError"
        ]
      }
    },
    {
      "id": "func.validateCreateBookRequest",
      "label": "validateCreateBookRequest",
      "type": "func",
      "group": "function",
      "metadata": {
        "kind": "func",
        "role": null,
        "intent": "Validate request body for creating a book",
        "purpose": null,
        "fields": {},
        "input": [
          "schema.CreateBookRequest"
        ],
        "output": [
          "schema.CreateBookRequest",
          "schema.ValidationError"
        ]
      }
    },
    {
      "id": "func.validateGetBookRequest",
      "label": "validateGetBookRequest",
      "type": "func",
      "group": "function",
      "metadata": {
        "kind": "func",
        "role": null,
        "intent": "Validate request parameters for getting a book",
        "purpose": null,
        "fields": {},
        "input": [
          "schema.GetBookRequest"
        ],
        "output": [
          "schema.GetBookRequest",
          "schema.ValidationError"
        ]
      }
    },
    {
      "id": "func.validateUpdateBookRequest",
      "label": "validateUpdateBookRequest",
      "type": "func",
      "group": "function",
      "metadata": {
        "kind": "func",
        "role": null,
        "intent": "Validate request body for updating a book",
        "purpose": null,
        "fields": {},
        "input": [
          "schema.UpdateBookRequest"
        ],
        "output": [
          "schema.UpdateBookRequest",
          "schema.ValidationError"
        ]
      }
    },
    {
      "id": "mod.book_api",
      "label": "book_api",
      "type": "mod",
      "group": "module",
      "metadata": {
        "kind": "mod",
        "role": null,
        "intent": null,
        "purpose": "Book library REST API with CRUD operations",
        "fields": {},
        "input": [],
        "output": []
      }
    },
    {
      "id": "schema.EventProcessed",
      "label": "EventProcessed",
      "type": "schema",
      "group": "node",
      "metadata": {
        "kind": "node",
        "role": "output",
        "intent": null,
        "purpose": null,
        "fields": {
          "processed_at": "timestamp",
          "event_id": "uuid",
          "trace_id": "string"
        },
        "input": [],
        "output": []
      }
    },
    {
      "id": "schema.EventProcessingError",
      "label": "EventProcessingError",
      "type": "schema",
      "group": "node",
      "metadata": {
        "kind": "node",
        "role": "error",
        "intent": null,
        "purpose": null,
        "fields": {
          "retryable": "bool",
          "trace_id": "string",
          "event_id": "uuid",
          "error_message": "string"
        },
        "input": [],
        "output": []
      }
    },
    {
      "id": "schema.OrderCreatedEvent",
      "label": "OrderCreatedEvent",
      "type": "schema",
      "group": "node",
      "metadata": {
        "kind": "node",
        "role": "event",
        "intent": null,
        "purpose": null,
        "fields": {
          "order_id": "uuid",
          "timestamp": "timestamp",
          "event_id": "uuid",
          "trace_id": "string",
          "source": "string",
          "total_amount": "float",
          "customer_id": "uuid"
        },
        "input": [],
        "output": []
      }
    },
    {
      "id": "schema.OrderPaidEvent",
      "label": "OrderPaidEvent",
      "type": "schema",
      "group": "node",
      "metadata": {
        "kind": "node",
        "role": "event",
        "intent": null,
        "purpose": null,
        "fields": {
          "trace_id": "string",
          "payment_id": "uuid",
          "amount": "float",
          "event_id": "uuid",
          "order_id": "uuid",
          "source": "string",
          "timestamp": "timestamp"
        },
        "input": [],
        "output": []
      }
    },
    {
      "id": "schema.SendEmailEvent",
      "label": "SendEmailEvent",
      "type": "schema",
      "group": "node",
      "metadata": {
        "kind": "node",
        "role": "event",
        "intent": null,
        "purpose": null,
        "fields": {
          "trace_id": "string",
          "timestamp": "timestamp",
          "to": "string",
          "event_id": "uuid",
          "data": "json",
          "template": "string"
        },
        "input": [],
        "output": []
      }
    },
    {
      "id": "schema.UpdateInventoryEvent",
      "label": "UpdateInventoryEvent",
      "type": "schema",
      "group": "node",
      "metadata": {
        "kind": "node",
        "role": "event",
        "intent": null,
        "purpose": null,
        "fields": {
          "trace_id": "string",
          "timestamp": "timestamp",
          "items": "json",
          "order_id": "uuid",
          "event_id": "uuid"
        },
        "input": [],
        "output": []
      }
    },
    {
      "id": "func.handleOrderCreated",
      "label": "handleOrderCreated",
      "type": "func",
      "group": "function",
      "metadata": {
        "kind": "func",
        "role": null,
        "intent": "Handle order created event: send confirmation email and reserve inventory",
        "purpose": null,
        "fields": {},
        "input": [
          "schema.OrderCreatedEvent"
        ],
        "output": [
          "schema.SendEmailEvent",
          "schema.UpdateInventoryEvent",
          "schema.EventProcessingError"
        ]
      }
    },
    {
      "id": "func.handleOrderPaid",
      "label": "handleOrderPaid",
      "type": "func",
      "group": "function",
      "metadata": {
        "kind": "func",
        "role": null,
        "intent": "Handle order paid event: send payment confirmation",
        "purpose": null,
        "fields": {},
        "input": [
          "schema.OrderPaidEvent"
        ],
        "output": [
          "schema.SendEmailEvent",
          "schema.EventProcessingError"
        ]
      }
    },
    {
      "id": "func.publishEmailEvent",
      "label": "publishEmailEvent",
      "type": "func",
      "group": "function",
      "metadata": {
        "kind": "func",
        "role": null,
        "intent": "Publish email event to email service queue",
        "purpose": null,
        "fields": {},
        "input": [
          "schema.SendEmailEvent"
        ],
        "output": [
          "schema.EventProcessed",
          "schema.EventProcessingError"
        ]
      }
    },
    {
      "id": "func.publishInventoryEvent",
      "label": "publishInventoryEvent",
      "type": "func",
      "group": "function",
      "metadata": {
        "kind": "func",
        "role": null,
        "intent": "Publish inventory update event",
        "purpose": null,
        "fields": {},
        "input": [
          "schema.UpdateInventoryEvent"
        ],
        "output": [
          "schema.EventProcessed",
          "schema.EventProcessingError"
        ]
      }
    },
    {
      "id": "func.validateEvent",
      "label": "validateEvent",
      "type": "func",
      "group": "function",
      "metadata": {
        "kind": "func",
        "role": null,
        "intent": "Validate event structure and deduplicate",
        "purpose": null,
        "fields": {},
        "input": [
          "schema.OrderCreatedEvent"
        ],
        "output": [
          "schema.OrderCreatedEvent",
          "schema.EventProcessingError"
        ]
      }
    },
    {
      "id": "mod.order_event_processor",
      "label": "order_event_processor",
      "type": "mod",
      "group": "module",
      "metadata": {
        "kind": "mod",
        "role": null,
        "intent": null,
        "purpose": "Process order lifecycle events and trigger downstream actions",
        "fields": {},
        "input": [],
        "output": []
      }
    },
    {
      "id": "schema.token",
      "label": "token",
      "type": "schema",
      "group": "node",
      "metadata": {
        "kind": "node",
        "role": "data",
        "intent": null,
        "purpose": null,
        "fields": {
          "user_id": "string",
          "token": "string"
        },
        "input": [],
        "output": []
      }
    },
    {
      "id": "func.validate_token",
      "label": "validate_token",
      "type": "func",
      "group": "function",
      "metadata": {
        "kind": "func",
        "role": null,
        "intent": "Validate authentication token",
        "purpose": null,
        "fields": {},
        "input": [
          "schema.token"
        ],
        "output": [
          "schema.token"
        ]
      }
    },
    {
      "id": "mod.auth",
      "label": "auth",
      "type": "mod",
      "group": "module",
      "metadata": {
        "kind": "mod",
        "role": null,
        "intent": null,
        "purpose": "Authentication service",
        "fields": {},
        "input": [],
        "output": []
      }
    }
  ],
  "links": [
    {
      "source": "schema.users_snapshot",
      "target": "schema.user",
      "label": "contains",
      "type": "boundary"
    },
    {
      "source": "schema.create_user_req",
      "target": "func.create_user",
      "label": "input",
      "type": "func_input"
    },
    {
      "source": "func.create_user",
      "target": "schema.user",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "schema.users_snapshot",
      "target": "func.get_user",
      "label": "input",
      "type": "func_input"
    },
    {
      "source": "func.get_user",
      "target": "schema.user",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "schema.user",
      "target": "func.save_user",
      "label": "input",
      "type": "func_input"
    },
    {
      "source": "schema.users_snapshot",
      "target": "func.save_user",
      "label": "input",
      "type": "func_input"
    },
    {
      "source": "func.save_user",
      "target": "schema.users_snapshot",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "mod.user_http_api",
      "target": "schema.user",
      "label": "uses",
      "type": "mod_schema"
    },
    {
      "source": "mod.user_http_api",
      "target": "schema.create_user_req",
      "label": "uses",
      "type": "mod_schema"
    },
    {
      "source": "mod.user_http_api",
      "target": "schema.users_snapshot",
      "label": "uses",
      "type": "mod_schema"
    },
    {
      "source": "mod.user_http_api",
      "target": "func.create_user",
      "label": "uses",
      "type": "mod_func"
    },
    {
      "source": "mod.user_http_api",
      "target": "func.save_user",
      "label": "uses",
      "type": "mod_func"
    },
    {
      "source": "mod.user_http_api",
      "target": "func.get_user",
      "label": "uses",
      "type": "mod_func"
    },
    {
      "source": "schema.CreateTodoRequest",
      "target": "func.createTodo",
      "label": "input",
      "type": "func_input"
    },
    {
      "source": "func.createTodo",
      "target": "schema.Todo",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "schema.Todo",
      "target": "func.deleteTodo",
      "label": "input",
      "type": "func_input"
    },
    {
      "source": "func.deleteTodo",
      "target": "schema.Todo",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "func.deleteTodo",
      "target": "schema.NotFoundError",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "schema.Todo",
      "target": "func.getTodo",
      "label": "input",
      "type": "func_input"
    },
    {
      "source": "func.getTodo",
      "target": "schema.Todo",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "func.getTodo",
      "target": "schema.NotFoundError",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "func.listTodos",
      "target": "schema.TodoListResponse",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "schema.Todo",
      "target": "func.serializeResponse",
      "label": "input",
      "type": "func_input"
    },
    {
      "source": "func.serializeResponse",
      "target": "schema.TodoResponse",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "schema.UpdateTodoRequest",
      "target": "func.updateTodo",
      "label": "input",
      "type": "func_input"
    },
    {
      "source": "func.updateTodo",
      "target": "schema.Todo",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "func.updateTodo",
      "target": "schema.NotFoundError",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "schema.CreateTodoRequest",
      "target": "func.validateCreateRequest",
      "label": "input",
      "type": "func_input"
    },
    {
      "source": "func.validateCreateRequest",
      "target": "schema.CreateTodoRequest",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "func.validateCreateRequest",
      "target": "schema.ValidationError",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "mod.todo_api",
      "target": "schema.Todo",
      "label": "uses",
      "type": "mod_schema"
    },
    {
      "source": "mod.todo_api",
      "target": "schema.CreateTodoRequest",
      "label": "uses",
      "type": "mod_schema"
    },
    {
      "source": "mod.todo_api",
      "target": "schema.UpdateTodoRequest",
      "label": "uses",
      "type": "mod_schema"
    },
    {
      "source": "mod.todo_api",
      "target": "schema.TodoResponse",
      "label": "uses",
      "type": "mod_schema"
    },
    {
      "source": "mod.todo_api",
      "target": "schema.TodoListResponse",
      "label": "uses",
      "type": "mod_schema"
    },
    {
      "source": "mod.todo_api",
      "target": "schema.ValidationError",
      "label": "uses",
      "type": "mod_schema"
    },
    {
      "source": "mod.todo_api",
      "target": "schema.NotFoundError",
      "label": "uses",
      "type": "mod_schema"
    },
    {
      "source": "mod.todo_api",
      "target": "func.validateCreateRequest",
      "label": "uses",
      "type": "mod_func"
    },
    {
      "source": "mod.todo_api",
      "target": "func.createTodo",
      "label": "uses",
      "type": "mod_func"
    },
    {
      "source": "mod.todo_api",
      "target": "func.getTodo",
      "label": "uses",
      "type": "mod_func"
    },
    {
      "source": "mod.todo_api",
      "target": "func.updateTodo",
      "label": "uses",
      "type": "mod_func"
    },
    {
      "source": "mod.todo_api",
      "target": "func.deleteTodo",
      "label": "uses",
      "type": "mod_func"
    },
    {
      "source": "mod.todo_api",
      "target": "func.listTodos",
      "label": "uses",
      "type": "mod_func"
    },
    {
      "source": "mod.todo_api",
      "target": "func.serializeResponse",
      "label": "uses",
      "type": "mod_func"
    },
    {
      "source": "schema.EnrichedClickEvent",
      "target": "func.aggregateSessionMetrics",
      "label": "input",
      "type": "func_input"
    },
    {
      "source": "func.aggregateSessionMetrics",
      "target": "schema.SessionAggregation",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "schema.SessionAggregation",
      "target": "func.calculateDailyMetrics",
      "label": "input",
      "type": "func_input"
    },
    {
      "source": "func.calculateDailyMetrics",
      "target": "schema.DailyMetrics",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "schema.EnrichedClickEvent",
      "target": "func.enrichWithDeviceInfo",
      "label": "input",
      "type": "func_input"
    },
    {
      "source": "func.enrichWithDeviceInfo",
      "target": "schema.EnrichedClickEvent",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "schema.ParsedClickEvent",
      "target": "func.enrichWithGeoData",
      "label": "input",
      "type": "func_input"
    },
    {
      "source": "func.enrichWithGeoData",
      "target": "schema.EnrichedClickEvent",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "func.ingestClickEvents",
      "target": "schema.RawClickEvent",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "schema.RawClickEvent",
      "target": "func.parseClickEvent",
      "label": "input",
      "type": "func_input"
    },
    {
      "source": "func.parseClickEvent",
      "target": "schema.ParsedClickEvent",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "func.parseClickEvent",
      "target": "schema.ParseError",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "schema.ParsedClickEvent",
      "target": "func.validateEvent",
      "label": "input",
      "type": "func_input"
    },
    {
      "source": "func.validateEvent",
      "target": "schema.ParsedClickEvent",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "func.validateEvent",
      "target": "schema.ValidationError",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "schema.DailyMetrics",
      "target": "func.writeDailyMetrics",
      "label": "input",
      "type": "func_input"
    },
    {
      "source": "mod.analytics_pipeline",
      "target": "schema.RawClickEvent",
      "label": "uses",
      "type": "mod_schema"
    },
    {
      "source": "mod.analytics_pipeline",
      "target": "schema.ParsedClickEvent",
      "label": "uses",
      "type": "mod_schema"
    },
    {
      "source": "mod.analytics_pipeline",
      "target": "schema.EnrichedClickEvent",
      "label": "uses",
      "type": "mod_schema"
    },
    {
      "source": "mod.analytics_pipeline",
      "target": "schema.SessionAggregation",
      "label": "uses",
      "type": "mod_schema"
    },
    {
      "source": "mod.analytics_pipeline",
      "target": "schema.DailyMetrics",
      "label": "uses",
      "type": "mod_schema"
    },
    {
      "source": "mod.analytics_pipeline",
      "target": "schema.ParseError",
      "label": "uses",
      "type": "mod_schema"
    },
    {
      "source": "mod.analytics_pipeline",
      "target": "schema.ValidationError",
      "label": "uses",
      "type": "mod_schema"
    },
    {
      "source": "mod.analytics_pipeline",
      "target": "func.ingestClickEvents",
      "label": "uses",
      "type": "mod_func"
    },
    {
      "source": "mod.analytics_pipeline",
      "target": "func.parseClickEvent",
      "label": "uses",
      "type": "mod_func"
    },
    {
      "source": "mod.analytics_pipeline",
      "target": "func.validateEvent",
      "label": "uses",
      "type": "mod_func"
    },
    {
      "source": "mod.analytics_pipeline",
      "target": "func.enrichWithGeoData",
      "label": "uses",
      "type": "mod_func"
    },
    {
      "source": "mod.analytics_pipeline",
      "target": "func.enrichWithDeviceInfo",
      "label": "uses",
      "type": "mod_func"
    },
    {
      "source": "mod.analytics_pipeline",
      "target": "func.aggregateSessionMetrics",
      "label": "uses",
      "type": "mod_func"
    },
    {
      "source": "mod.analytics_pipeline",
      "target": "func.calculateDailyMetrics",
      "label": "uses",
      "type": "mod_func"
    },
    {
      "source": "mod.analytics_pipeline",
      "target": "func.writeDailyMetrics",
      "label": "uses",
      "type": "mod_func"
    },
    {
      "source": "schema.CreateUserData",
      "target": "func.createUser",
      "label": "input",
      "type": "func_input"
    },
    {
      "source": "func.createUser",
      "target": "schema.User",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "func.createUser",
      "target": "schema.DuplicateKeyError",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "func.createUser",
      "target": "schema.DatabaseError",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "schema.UserByIdQuery",
      "target": "func.deleteUser",
      "label": "input",
      "type": "func_input"
    },
    {
      "source": "func.deleteUser",
      "target": "schema.User",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "func.deleteUser",
      "target": "schema.NotFoundError",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "func.deleteUser",
      "target": "schema.DatabaseError",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "schema.UserByEmailQuery",
      "target": "func.findUserByEmail",
      "label": "input",
      "type": "func_input"
    },
    {
      "source": "func.findUserByEmail",
      "target": "schema.User",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "func.findUserByEmail",
      "target": "schema.NotFoundError",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "func.findUserByEmail",
      "target": "schema.DatabaseError",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "schema.UserByIdQuery",
      "target": "func.findUserById",
      "label": "input",
      "type": "func_input"
    },
    {
      "source": "func.findUserById",
      "target": "schema.User",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "func.findUserById",
      "target": "schema.NotFoundError",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "func.findUserById",
      "target": "schema.DatabaseError",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "schema.UpdateUserData",
      "target": "func.updateUser",
      "label": "input",
      "type": "func_input"
    },
    {
      "source": "func.updateUser",
      "target": "schema.User",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "func.updateUser",
      "target": "schema.NotFoundError",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "func.updateUser",
      "target": "schema.DatabaseError",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "mod.user_repository",
      "target": "schema.User",
      "label": "uses",
      "type": "mod_schema"
    },
    {
      "source": "mod.user_repository",
      "target": "schema.UserByIdQuery",
      "label": "uses",
      "type": "mod_schema"
    },
    {
      "source": "mod.user_repository",
      "target": "schema.UserByEmailQuery",
      "label": "uses",
      "type": "mod_schema"
    },
    {
      "source": "mod.user_repository",
      "target": "schema.CreateUserData",
      "label": "uses",
      "type": "mod_schema"
    },
    {
      "source": "mod.user_repository",
      "target": "schema.UpdateUserData",
      "label": "uses",
      "type": "mod_schema"
    },
    {
      "source": "mod.user_repository",
      "target": "schema.NotFoundError",
      "label": "uses",
      "type": "mod_schema"
    },
    {
      "source": "mod.user_repository",
      "target": "schema.DuplicateKeyError",
      "label": "uses",
      "type": "mod_schema"
    },
    {
      "source": "mod.user_repository",
      "target": "schema.DatabaseError",
      "label": "uses",
      "type": "mod_schema"
    },
    {
      "source": "mod.user_repository",
      "target": "func.findUserById",
      "label": "uses",
      "type": "mod_func"
    },
    {
      "source": "mod.user_repository",
      "target": "func.findUserByEmail",
      "label": "uses",
      "type": "mod_func"
    },
    {
      "source": "mod.user_repository",
      "target": "func.createUser",
      "label": "uses",
      "type": "mod_func"
    },
    {
      "source": "mod.user_repository",
      "target": "func.updateUser",
      "label": "uses",
      "type": "mod_func"
    },
    {
      "source": "mod.user_repository",
      "target": "func.deleteUser",
      "label": "uses",
      "type": "mod_func"
    },
    {
      "source": "schema.CreateBookRequest",
      "target": "func.createBook",
      "label": "input",
      "type": "func_input"
    },
    {
      "source": "func.createBook",
      "target": "schema.Book",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "func.createBook",
      "target": "schema.ConflictError",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "schema.DeleteBookRequest",
      "target": "func.deleteBook",
      "label": "input",
      "type": "func_input"
    },
    {
      "source": "func.deleteBook",
      "target": "schema.Book",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "func.deleteBook",
      "target": "schema.NotFoundError",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "schema.GetBookRequest",
      "target": "func.getBook",
      "label": "input",
      "type": "func_input"
    },
    {
      "source": "func.getBook",
      "target": "schema.Book",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "func.getBook",
      "target": "schema.NotFoundError",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "func.listBooks",
      "target": "schema.BookListResponse",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "schema.BookListResponse",
      "target": "func.serializeBookListResponse",
      "label": "input",
      "type": "func_input"
    },
    {
      "source": "func.serializeBookListResponse",
      "target": "schema.BookListResponse",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "schema.Book",
      "target": "func.serializeBookResponse",
      "label": "input",
      "type": "func_input"
    },
    {
      "source": "func.serializeBookResponse",
      "target": "schema.BookResponse",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "schema.UpdateBookRequest",
      "target": "func.updateBook",
      "label": "input",
      "type": "func_input"
    },
    {
      "source": "func.updateBook",
      "target": "schema.Book",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "func.updateBook",
      "target": "schema.NotFoundError",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "schema.CreateBookRequest",
      "target": "func.validateCreateBookRequest",
      "label": "input",
      "type": "func_input"
    },
    {
      "source": "func.validateCreateBookRequest",
      "target": "schema.CreateBookRequest",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "func.validateCreateBookRequest",
      "target": "schema.ValidationError",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "schema.GetBookRequest",
      "target": "func.validateGetBookRequest",
      "label": "input",
      "type": "func_input"
    },
    {
      "source": "func.validateGetBookRequest",
      "target": "schema.GetBookRequest",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "func.validateGetBookRequest",
      "target": "schema.ValidationError",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "schema.UpdateBookRequest",
      "target": "func.validateUpdateBookRequest",
      "label": "input",
      "type": "func_input"
    },
    {
      "source": "func.validateUpdateBookRequest",
      "target": "schema.UpdateBookRequest",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "func.validateUpdateBookRequest",
      "target": "schema.ValidationError",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "mod.book_api",
      "target": "schema.Book",
      "label": "uses",
      "type": "mod_schema"
    },
    {
      "source": "mod.book_api",
      "target": "schema.GetBookRequest",
      "label": "uses",
      "type": "mod_schema"
    },
    {
      "source": "mod.book_api",
      "target": "schema.CreateBookRequest",
      "label": "uses",
      "type": "mod_schema"
    },
    {
      "source": "mod.book_api",
      "target": "schema.UpdateBookRequest",
      "label": "uses",
      "type": "mod_schema"
    },
    {
      "source": "mod.book_api",
      "target": "schema.DeleteBookRequest",
      "label": "uses",
      "type": "mod_schema"
    },
    {
      "source": "mod.book_api",
      "target": "schema.BookResponse",
      "label": "uses",
      "type": "mod_schema"
    },
    {
      "source": "mod.book_api",
      "target": "schema.BookListResponse",
      "label": "uses",
      "type": "mod_schema"
    },
    {
      "source": "mod.book_api",
      "target": "schema.ValidationError",
      "label": "uses",
      "type": "mod_schema"
    },
    {
      "source": "mod.book_api",
      "target": "schema.NotFoundError",
      "label": "uses",
      "type": "mod_schema"
    },
    {
      "source": "mod.book_api",
      "target": "schema.ConflictError",
      "label": "uses",
      "type": "mod_schema"
    },
    {
      "source": "mod.book_api",
      "target": "func.validateGetBookRequest",
      "label": "uses",
      "type": "mod_func"
    },
    {
      "source": "mod.book_api",
      "target": "func.validateCreateBookRequest",
      "label": "uses",
      "type": "mod_func"
    },
    {
      "source": "mod.book_api",
      "target": "func.validateUpdateBookRequest",
      "label": "uses",
      "type": "mod_func"
    },
    {
      "source": "mod.book_api",
      "target": "func.getBook",
      "label": "uses",
      "type": "mod_func"
    },
    {
      "source": "mod.book_api",
      "target": "func.createBook",
      "label": "uses",
      "type": "mod_func"
    },
    {
      "source": "mod.book_api",
      "target": "func.updateBook",
      "label": "uses",
      "type": "mod_func"
    },
    {
      "source": "mod.book_api",
      "target": "func.deleteBook",
      "label": "uses",
      "type": "mod_func"
    },
    {
      "source": "mod.book_api",
      "target": "func.listBooks",
      "label": "uses",
      "type": "mod_func"
    },
    {
      "source": "mod.book_api",
      "target": "func.serializeBookResponse",
      "label": "uses",
      "type": "mod_func"
    },
    {
      "source": "mod.book_api",
      "target": "func.serializeBookListResponse",
      "label": "uses",
      "type": "mod_func"
    },
    {
      "source": "schema.OrderCreatedEvent",
      "target": "func.handleOrderCreated",
      "label": "input",
      "type": "func_input"
    },
    {
      "source": "func.handleOrderCreated",
      "target": "schema.SendEmailEvent",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "func.handleOrderCreated",
      "target": "schema.UpdateInventoryEvent",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "func.handleOrderCreated",
      "target": "schema.EventProcessingError",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "schema.OrderPaidEvent",
      "target": "func.handleOrderPaid",
      "label": "input",
      "type": "func_input"
    },
    {
      "source": "func.handleOrderPaid",
      "target": "schema.SendEmailEvent",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "func.handleOrderPaid",
      "target": "schema.EventProcessingError",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "schema.SendEmailEvent",
      "target": "func.publishEmailEvent",
      "label": "input",
      "type": "func_input"
    },
    {
      "source": "func.publishEmailEvent",
      "target": "schema.EventProcessed",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "func.publishEmailEvent",
      "target": "schema.EventProcessingError",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "schema.UpdateInventoryEvent",
      "target": "func.publishInventoryEvent",
      "label": "input",
      "type": "func_input"
    },
    {
      "source": "func.publishInventoryEvent",
      "target": "schema.EventProcessed",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "func.publishInventoryEvent",
      "target": "schema.EventProcessingError",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "schema.OrderCreatedEvent",
      "target": "func.validateEvent",
      "label": "input",
      "type": "func_input"
    },
    {
      "source": "func.validateEvent",
      "target": "schema.OrderCreatedEvent",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "func.validateEvent",
      "target": "schema.EventProcessingError",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "mod.order_event_processor",
      "target": "schema.OrderCreatedEvent",
      "label": "uses",
      "type": "mod_schema"
    },
    {
      "source": "mod.order_event_processor",
      "target": "schema.OrderPaidEvent",
      "label": "uses",
      "type": "mod_schema"
    },
    {
      "source": "mod.order_event_processor",
      "target": "schema.SendEmailEvent",
      "label": "uses",
      "type": "mod_schema"
    },
    {
      "source": "mod.order_event_processor",
      "target": "schema.UpdateInventoryEvent",
      "label": "uses",
      "type": "mod_schema"
    },
    {
      "source": "mod.order_event_processor",
      "target": "schema.EventProcessed",
      "label": "uses",
      "type": "mod_schema"
    },
    {
      "source": "mod.order_event_processor",
      "target": "schema.EventProcessingError",
      "label": "uses",
      "type": "mod_schema"
    },
    {
      "source": "mod.order_event_processor",
      "target": "func.handleOrderCreated",
      "label": "uses",
      "type": "mod_func"
    },
    {
      "source": "mod.order_event_processor",
      "target": "func.handleOrderPaid",
      "label": "uses",
      "type": "mod_func"
    },
    {
      "source": "mod.order_event_processor",
      "target": "func.publishEmailEvent",
      "label": "uses",
      "type": "mod_func"
    },
    {
      "source": "mod.order_event_processor",
      "target": "func.publishInventoryEvent",
      "label": "uses",
      "type": "mod_func"
    },
    {
      "source": "mod.order_event_processor",
      "target": "func.validateEvent",
      "label": "uses",
      "type": "mod_func"
    },
    {
      "source": "schema.token",
      "target": "func.validate_token",
      "label": "input",
      "type": "func_input"
    },
    {
      "source": "func.validate_token",
      "target": "schema.token",
      "label": "output",
      "type": "func_output"
    },
    {
      "source": "mod.auth",
      "target": "schema.token",
      "label": "uses",
      "type": "mod_schema"
    },
    {
      "source": "mod.auth",
      "target": "func.validate_token",
      "label": "uses",
      "type": "mod_func"
    },
    {
      "source": "mod.user_http_api",
      "target": "mod.auth",
      "label": "requires",
      "type": "mod_require"
    }
  ]
};

        const width = document.getElementById('graph').clientWidth;
        const height = document.getElementById('graph').clientHeight;

        const svg = d3.select('#svg');
        const g = svg.append('g');

        const zoom = d3.zoom()
            .scaleExtent([0.1, 4])
            .on('zoom', (event) => {
                g.attr('transform', event.transform);
            });

        svg.call(zoom);

        const colorMap = {
            'node': '#2980b9',
            'edge': '#27ae60',
            'boundary': '#f39c12',
            'space': '#8e44ad',
            'function': '#27ae60',
            'module': '#8e44ad'
        };

        const simulation = d3.forceSimulation(data.nodes)
            .force('link', d3.forceLink(data.links).id(d => d.id).distance(150))
            .force('charge', d3.forceManyBody().strength(-400))
            .force('center', d3.forceCenter(width / 2, height / 2))
            .force('collision', d3.forceCollide().radius(40));

        const link = g.append('g')
            .selectAll('path')
            .data(data.links)
            .join('path')
            .attr('class', 'link')
            .attr('data-type', d => d.type)
            .attr('marker-end', 'url(#arrow)');

        svg.append('defs').append('marker')
            .attr('id', 'arrow')
            .attr('viewBox', '0 -5 10 10')
            .attr('refX', 25)
            .attr('refY', 0)
            .attr('markerWidth', 6)
            .attr('markerHeight', 6)
            .attr('orient', 'auto')
            .append('path')
            .attr('d', 'M0,-5L10,0L0,5')
            .attr('fill', '#666');

        const node = g.append('g')
            .selectAll('g')
            .data(data.nodes)
            .join('g')
            .attr('class', 'node')
            .attr('data-type', d => d.type)
            .attr('data-group', d => d.group)
            .call(d3.drag()
                .on('start', dragstarted)
                .on('drag', dragged)
                .on('end', dragended));

        node.append('circle')
            .attr('r', 20)
            .attr('fill', d => colorMap[d.group] || '#999');

        node.append('text')
            .attr('dy', 35)
            .text(d => d.label);

        node.on('click', (event, d) => {
            event.stopPropagation();
            showDetail(d);
            highlightConnections(d);
        });

        svg.on('click', () => {
            hideDetail();
            clearHighlight();
        });

        simulation.on('tick', () => {
            link.attr('d', d => {
                const dx = d.target.x - d.source.x;
                const dy = d.target.y - d.source.y;
                return `M${d.source.x},${d.source.y}L${d.target.x},${d.target.y}`;
            });

            node.attr('transform', d => `translate(${d.x},${d.y})`);
        });

        function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }

        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }

        function dragended(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
        }

        function showDetail(d) {
            const panel = document.getElementById('detail-panel');
            const content = document.getElementById('detail-content');

            let html = `<h2>${d.label}</h2>`;
            html += `<div class="detail-section"><h4>Type</h4><p>${d.type} (${d.group})</p></div>`;

            if (d.metadata.kind) {
                html += `<div class="detail-section"><h4>Kind</h4><p>${d.metadata.kind}</p></div>`;
            }

            if (d.metadata.role) {
                html += `<div class="detail-section"><h4>Role</h4><p>${d.metadata.role}</p></div>`;
            }

            if (d.metadata.intent) {
                html += `<div class="detail-section"><h4>Intent</h4><p>${d.metadata.intent}</p></div>`;
            }

            if (d.metadata.purpose) {
                html += `<div class="detail-section"><h4>Purpose</h4><p>${d.metadata.purpose}</p></div>`;
            }

            if (d.metadata.input && d.metadata.input.length > 0) {
                html += `<div class="detail-section"><h4>Input</h4><ul class="detail-list">`;
                d.metadata.input.forEach(i => html += `<li>${i}</li>`);
                html += `</ul></div>`;
            }

            if (d.metadata.output && d.metadata.output.length > 0) {
                html += `<div class="detail-section"><h4>Output</h4><ul class="detail-list">`;
                d.metadata.output.forEach(o => html += `<li>${o}</li>`);
                html += `</ul></div>`;
            }

            if (Object.keys(d.metadata.fields).length > 0) {
                html += `<div class="detail-section"><h4>Fields</h4><table class="field-table">`;
                for (const [key, value] of Object.entries(d.metadata.fields)) {
                    html += `<tr><td>${key}</td><td>${value}</td></tr>`;
                }
                html += `</table></div>`;
            }

            content.innerHTML = html;
            panel.classList.add('active');
        }

        function hideDetail() {
            document.getElementById('detail-panel').classList.remove('active');
        }

        function highlightConnections(d) {
            const connectedNodes = new Set([d.id]);
            const connectedLinks = new Set();

            data.links.forEach(l => {
                if (l.source.id === d.id || l.target.id === d.id) {
                    connectedLinks.add(l);
                    connectedNodes.add(l.source.id);
                    connectedNodes.add(l.target.id);
                }
            });

            node.classed('dimmed', n => !connectedNodes.has(n.id))
                .classed('highlighted', n => n.id === d.id);

            link.classed('dimmed', l => !connectedLinks.has(l))
                .classed('highlighted', l => connectedLinks.has(l));
        }

        function clearHighlight() {
            node.classed('dimmed', false).classed('highlighted', false);
            link.classed('dimmed', false).classed('highlighted', false);
        }

        // Search
        document.getElementById('search').addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            node.classed('dimmed', d => !d.label.toLowerCase().includes(query));
        });

        // Filters
        function updateFilters() {
            const typeFilters = {
                'schema': document.getElementById('filter-schema').checked,
                'func': document.getElementById('filter-func').checked,
                'mod': document.getElementById('filter-mod').checked
            };

            const groupFilters = {
                'node': document.getElementById('filter-node').checked,
                'edge': document.getElementById('filter-edge').checked,
                'boundary': document.getElementById('filter-boundary').checked,
                'space': document.getElementById('filter-space').checked,
                'function': true,
                'module': true
            };

            const linkFilters = {
                'func_input': document.getElementById('link-func').checked,
                'func_output': document.getElementById('link-func').checked,
                'mod_schema': document.getElementById('link-mod').checked,
                'mod_func': document.getElementById('link-mod').checked,
                'mod_require': document.getElementById('link-require').checked,
                'edge_from': document.getElementById('link-schema').checked,
                'edge_to': document.getElementById('link-schema').checked,
                'boundary': document.getElementById('link-schema').checked,
                'space': document.getElementById('link-schema').checked
            };

            node.style('display', d => {
                return typeFilters[d.type] && groupFilters[d.group] ? 'block' : 'none';
            });

            link.style('display', l => {
                return linkFilters[l.type] ? 'block' : 'none';
            });
        }

        document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
            cb.addEventListener('change', updateFilters);
        });

        // Controls
        document.getElementById('reset-zoom').addEventListener('click', () => {
            svg.transition().duration(750).call(
                zoom.transform,
                d3.zoomIdentity.translate(0, 0).scale(1)
            );
        });

        document.getElementById('reset-positions').addEventListener('click', () => {
            simulation.alpha(1).restart();
        });

        document.getElementById('close-detail').addEventListener('click', () => {
            hideDetail();
            clearHighlight();
        });
    </script>
</body>
</html>
